# 报表制作

### 1.报表分解
```
公用维度+统计量 => 业务线<公用维度+统计量>
```

### 2.报表存储
```
Meta=<报表，层级主题，统计量编码，统计量类型，生效时间>
列形式数据=<公用维度，统计量编码，统计量值，时间>
行形式数据=<公用维度，统计量>

一般选择列形式
a.在OLAP数据库中列形式可以支持比较好的局部更新（维度和统计量都比较自由，业务线之间也可以独立更新）
b.在显示层利用meta进行合并并不会引入太大的代价（Filetr指定统计量后，聚合建立hashMap，按需获取）
c.结合元数据主题划分可以进行比较好的显示控制和逻辑管理（统计量的版本控制，基于设定配置表实现维度切换）
```

### 3.报表计算
```
行形式数据=Agg(实体宽表，口径*统计量，基础维度)
列形式数据=Explode(行形式报表存储，Array[(统计量编码，统计量值)]，基础维度)
层级数据SumUp=Agg(目标维度_基础维度对应关系 连接 基础维度聚合表，目标维度，统计量)
```

