# 规则连接分组问题(2)


### 分析步骤
```
1.规则-字段对应关系

2.画出规则和模型数量的关系
--一共有多少个不同的模型（35）
--找出依赖较多模型的规则（5）

3.画出规则和模型的对应关系
--规则在左边形成列表，模型在右边形成列表，存在关系则连线，使用这种方式画图（看不清）
--帮我直接使用热力图或者矩阵显示，行是规则，列是模型，若规则和模型存在对应关系则矩阵相应位置为 1，否则为 0（可以）
--对数据进行排序，让依赖相同模型的规则尽量集中，重新画一下热力图


4.画出模型之间的关联关系
--如果一个规则同时依赖n个模型则者n个模型，则者n个模型之间有关联，使用热力图刻画模型与模型之间的关联
--将这个关系转换为一个graph，转为dot文件 去除 DWD_ELEC_CONS_CUST_SHARE_A_V 点和边
--分析一下这里面有几个连通子图，画出20个连通子图内节点分布清单和数量
连通子图内节点分布清单和数量（按数量从大到小排序）：
连通子图 5: 数量 9, 节点 ['DWD_ADJ_VOLT_DEV_FAT_B_AGG_ELEC_CONS_CUST_UDF_V', 'DWD_ADJ_VOLT_DEV_FAT_B_AGG_ELEC_CONS_CUST_V', 'DWD_BP_CONTACT_FAT_B_AGG_ELEC_CONS_CUST_V', 'DWD_CONTRACT_FAT_B_AGG_ELEC_CONS_CUST_V', 'DWD_EN_PUR_ARCH_AGG_ELEC_CONS_CUST_FAT_B_V', 'DWD_INST_ELEC_CONS_FAT_B_AGG_ELEC_CONS_CUST_V', 'DWD_INST_ELEC_CONS_FAT_C_AGG_ELEC_CONS_CUST_V', 'DWD_METER_RUN_FAT_B_AGG_ELEC_CONS_CUST_COUNT_V', 'DWD_SETL_AGRT_FAT_B_AGG_ELEC_CONS_CUST_V']
连通子图 2: 数量 6, 节点 ['DWD_BUSINESS_PARTNER_BASE_ELEC_CONS_CUST_ADAPTER_V', 'DWD_CERT_SET_FAT_B_AGG_BP_CERT_SET_NAME_ELEC_CONS_CUST_ADAPTER_V', 'DWD_CERT_SET_FAT_B_AGG_BP_ELEC_CONS_CUST_ADAPTER_V', 'DWD_INST_BILG_CARD_BASE_HIS_PN_V_ACC_AGG_ELEC_CONS_CUST_BGN_LM', 'DWD_INST_BILG_CARD_FAT_B_AGG_CUST_NO_LNM_BEN_LM_V', 'DWD_VALUE_ADDED_TAX_FAT_B_AGG_BP_ELEC_CONS_CUST_ADAPTER_V']
连通子图 10: 数量 3, 节点 ['DWD_BP_CONTACT_FAT_C_AGG_CONS_SET_V', 'DWD_CONTACT_CHAN_ALL_AGG_ELEC_CONS_CUST_BASE_V', 'nan']
连通子图 1: 数量 1, 节点 ['DWD_INST_RELA_FAT_B_AGG_MAIN_ELEC_CONS_CUST_V']
连通子图 3: 数量 1, 节点 ['DWD_IND_CLS_BASE_ELEC_CONS_CUST_ADAPTER_V']
连通子图 4: 数量 1, 节点 ['DWD_BP_CONTACT_FAT_B_AGG_BP_ELEC_CONS_CUST_ADAPTER_V']
连通子图 6: 数量 1, 节点 ['DWD_BP_CONTACT_FAT_C_AGG_CONS_TAG_BY_CUST_V']
连通子图 7: 数量 1, 节点 ['DWD_ELEC_CONS_CUST_FAT_D_ADDR_V']
连通子图 8: 数量 1, 节点 ['DWD_BILG_UNIT_BASE_CUST_ADAPTER_V']
连通子图 9: 数量 1, 节点 ['DWD_MR_UNIT_BASE_CUST_ADAPTER_V']
连通子图 11: 数量 1, 节点 ['DWD_BP_CONTACT_FAT_C_AGG_CONS_TAG_BY_BP_V']
连通子图 12: 数量 1, 节点 ['DWD_CERT_SET_FAT_B_AGG_CONS_CERT_DISTINCT_INFO_V']
连通子图 13: 数量 1, 节点 ['DWD_BP_CONTACT_FAT_C_AGG_CONS_TAG_BY_CUST_V20250217_V']
连通子图 14: 数量 1, 节点 ['DWD_CUST_ELEC_APP_REC_FAT_B_AGG_ELEC_CONS_CUST_V']
连通子图 15: 数量 1, 节点 ['DWD_REG_READ_FAT_B_AGG_ELEC_CONS_CUST_V']
连通子图 16: 数量 1, 节点 ['DWD_SRV_LOC_ELEC_FAT_B_AGG_ELEC_CONS_CUST_V']
连通子图 17: 数量 1, 节点 ['DWD_ELEC_CONS_CUST_FAT_D_ADDR_OVER_CMNY_V']
连通子图 18: 数量 1, 节点 ['DWD_ELEC_CONS_CUST_FAT_D_ADDR_OVER_CMNY_03_9910_V']
连通子图 19: 数量 1, 节点 ['DWD_ELEC_CONS_CUST_FAT_D_ADDR_OVER_CMNY_03_9910_LOWER_BOUND_V']
连通子图 20: 数量 1, 节点 ['DWD_UN05_01_95598_ELEC_ADDR_QUALITY_CHECK_FAT_B_AGG_ELEC_CONS_CUST_V']
```

### 分析总结
```
Context
a.模型复用涉及35个表关联
b.实际上单规则依赖最多的模型仅为5个
c.规则和模型的依赖关系高度稀疏
d.模型关联当且仅当规则需要它们关联，在这种关系下模型关系高度稀疏

结论：
通过规则-字段-模型关系生成模型关系无向图，通过无向图找出最大连通子图在此算法下对模型进行分组，组内模型进行合并，在此分组下对模型计算过程进行改写可以减少join-shuffle

未来方向：
基于规则条件编码的true-false/kv模型可以进一步将对应关系分解到条件级，同一个条件对应的模型依赖更少，可以进一步将宽表进行分解并且支持条件（标签）级重算
```