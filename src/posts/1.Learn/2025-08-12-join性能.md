# join 性能


#### 一般性原则
```
优化思路
  1.小表提前broadCast
  2.小表先连
  3.连接下沉复用
工程实施
  1.base层映射存储物理表【业务稳定关系沉淀】
  2.share层【性能优化层】【内部引入顺序物化依赖关系】【避免循环依赖】【尽量减少连接计算，控制表的连接顺序小->大】
  3.fat层【实体宽表层-dwd/dws】
```


#### 只考虑列的影响
```
若仅考虑表的列数（忽略单位列大小系数 k和数据条数 M，仅关注列数对 Shuffle 量的相对贡献），则 N个表依次 LEFT JOIN 的总 Shuffle 量可简化为列数的加权和
N*C1+(N-1)*C2+...+2*CN-1+*CN
其中Ci为第i次的列数和
1.公式中，较早参与连接的表（如 T1）的列数被加权系数 N放大，因为其列会参与所有 N−1次连接的 Shuffle 过程
2.较晚参与连接的表（如 TN）的列数仅被加权系数 1放大，仅在最后一次连接中参与 Shuffle

因此，将列数多的表放在连接顺序的后期，可显著降低总 Shuffle 量（列数维度），这是优化多表连接性能的重要原则
```

#### PartialUpdate/主键模型
```
1.将同key-join进行union+agg转换【增加并行度，大量减少shuffle】
2.将不同key-join进行key-adapter转换【增加并行度，是否减少shuffle需要看具体情况】
```